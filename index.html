<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>MediaPipe Pose Landmarker Task for web</title>
    <link rel="stylesheet" href="./style.css" />
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet" />
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>

    <style>
      /* Ajustes quando entrar em fullscreen */
      #liveView:fullscreen,
      #liveView:-webkit-full-screen {
        width: 100vw;
        height: 100vh;
        background: #000;
      }
      #liveView:fullscreen video,
      #liveView:fullscreen canvas,
      #liveView:-webkit-full-screen video,
      #liveView:-webkit-full-screen canvas {
        width: 100vw !important;
        height: 100vh !important;
        object-fit: cover;
      }
      .controls {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
      }
    </style>
  </head>

  <body>
    <!-- Copyright 2023 The MediaPipe Authors. Apache 2.0 -->
    <div id="liveView" class="videoView">
      <div class="controls">
        <button id="webcamButton" class="mdc-button mdc-button--raised">
          <span class="mdc-button__ripple"></span>
          <span class="mdc-button__label">ENABLE WEBCAM</span>
        </button>

        <!-- BOTÃO FULLSCREEN -->
        <button id="fsButton" class="mdc-button mdc-button--outlined" aria-pressed="false" title="Fullscreen">
          <span class="mdc-button__ripple"></span>
          <span class="mdc-button__label">Fullscreen</span>
        </button>
      </div>

      <div style="position: relative;">
        <video id="webcam" style="width: 1280px; height: 720px; position: absolute; left:0; top:0;" autoplay playsinline></video>
        <canvas class="output_canvas" id="output_canvas" width="1280" height="720" style="position: absolute; left: 0; top: 0;"></canvas>
      </div>
    </div>

    <script type="module" src="./script.js"></script>

    <!-- JS do botão Fullscreen -->
    <script>
      const liveView = document.getElementById('liveView');
      const fsBtn = document.getElementById('fsButton');
      const videoEl = document.getElementById('webcam');

      const isFullscreen = () =>
        document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement;

      async function enterFullscreen(el) {
        if (el.requestFullscreen) return el.requestFullscreen();
        if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen(); // Safari
        if (el.msRequestFullscreen) return el.msRequestFullscreen(); // IE/Edge antigo
      }

      async function exitFullscreen() {
        if (document.exitFullscreen) return document.exitFullscreen();
        if (document.webkitExitFullscreen) return document.webkitExitFullscreen(); // Safari
        if (document.msExitFullscreen) return document.msExitFullscreen();
      }

      function updateFsButtonUI(full) {
        const label = fsBtn.querySelector('.mdc-button__label');
        if (full) {
          fsBtn.classList.add('mdc-button--raised');
          fsBtn.classList.remove('mdc-button--outlined');
          fsBtn.setAttribute('aria-pressed', 'true');
          label.textContent = 'Exit Fullscreen';
        } else {
          fsBtn.classList.remove('mdc-button--raised');
          fsBtn.classList.add('mdc-button--outlined');
          fsBtn.setAttribute('aria-pressed', 'false');
          label.textContent = 'Fullscreen';
        }
      }

      // Mantém o texto do botão sincronizado se o usuário sair pelo ESC
      ['fullscreenchange', 'webkitfullscreenchange', 'MSFullscreenChange'].forEach((evt) => {
        document.addEventListener(evt, () => updateFsButtonUI(!!isFullscreen()));
      });

      fsBtn.addEventListener('click', async () => {
        try {
          if (!isFullscreen()) {
            // Tenta fullscreen do container
            const supported =
              liveView.requestFullscreen || liveView.webkitRequestFullscreen || liveView.msRequestFullscreen;

            if (supported) {
              await enterFullscreen(liveView);
            } else if (videoEl && videoEl.webkitEnterFullscreen) {
              // Fallback: iOS antigo só permite fullscreen no <video>
              videoEl.webkitEnterFullscreen();
            }
            updateFsButtonUI(true);
          } else {
            await exitFullscreen();
            updateFsButtonUI(false);
          }
        } catch (err) {
          console.error('Fullscreen error:', err);
        }
      });
    </script>
  </body>
</html>
